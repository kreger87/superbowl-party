<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Bowl LX Props</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --navy: #002244;
      --green: #69BE28;
      --silver: #A5ACAF;
      --red: #C60C30;
      --bg: #f0f2f5;
      --card-bg: #ffffff;
      --text: #1a1a2e;
      --text-light: #6b7280;
      --shadow: 0 2px 8px rgba(0, 34, 68, 0.1);
      --shadow-lg: 0 4px 20px rgba(0, 34, 68, 0.15);
      --radius: 12px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--navy) 0%, #003366 40%, var(--navy) 60%, #1a1a3e 100%);
      padding: 2rem 1rem 2.5rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -20%;
      width: 60%;
      height: 200%;
      background: linear-gradient(135deg, var(--green) 0%, transparent 60%);
      opacity: 0.08;
      transform: rotate(-15deg);
    }

    .header::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 60%;
      height: 200%;
      background: linear-gradient(225deg, var(--red) 0%, transparent 60%);
      opacity: 0.08;
      transform: rotate(15deg);
    }

    .header h1 {
      font-size: 2.2rem;
      font-weight: 800;
      color: #fff;
      letter-spacing: -0.5px;
      position: relative;
      z-index: 1;
    }

    .header .subtitle {
      color: var(--silver);
      font-size: 1rem;
      margin-top: 0.4rem;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }

    .header .team-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.2rem;
      margin-top: 1rem;
      position: relative;
      z-index: 1;
    }

    .team-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.9rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .team-badge.seahawks {
      background: var(--green);
      color: var(--navy);
    }

    .team-badge.patriots {
      background: var(--red);
      color: #fff;
    }

    .vs-text {
      color: var(--silver);
      font-weight: 700;
      font-size: 0.9rem;
    }

    /* Container */
    .container {
      max-width: 640px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* Already submitted state */
    .already-submitted {
      text-align: center;
      padding: 3rem 1.5rem;
    }

    .already-submitted .check-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--green);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 2.5rem;
    }

    .already-submitted h2 {
      font-size: 1.5rem;
      color: var(--navy);
      margin-bottom: 0.5rem;
    }

    .already-submitted p {
      color: var(--text-light);
      margin-bottom: 1.5rem;
    }

    .already-submitted .name-highlight {
      font-weight: 700;
      color: var(--navy);
    }

    .already-submitted .leaderboard-link {
      display: inline-block;
      background: var(--navy);
      color: #fff;
      text-decoration: none;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 1rem;
      transition: opacity 0.2s;
    }

    .already-submitted .leaderboard-link:hover {
      opacity: 0.9;
    }

    .already-submitted .resubmit {
      display: block;
      margin-top: 1rem;
      color: var(--text-light);
      font-size: 0.85rem;
      cursor: pointer;
      text-decoration: underline;
      background: none;
      border: none;
      font-family: inherit;
    }

    .already-submitted .resubmit:hover {
      color: var(--navy);
    }

    /* Name input */
    .name-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }

    .name-card label {
      display: block;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--navy);
      margin-bottom: 0.5rem;
    }

    .name-card input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s;
      outline: none;
    }

    .name-card input:focus {
      border-color: var(--green);
    }

    .name-card input.error {
      border-color: var(--red);
    }

    /* Section headers */
    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 2rem 0 1rem;
      padding: 0 0.25rem;
    }

    .section-header h2 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--navy);
      text-transform: uppercase;
      letter-spacing: 1px;
      white-space: nowrap;
    }

    .section-header::after {
      content: '';
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, var(--silver), transparent);
    }

    /* Question cards */
    .question-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.25rem 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
      border-left: 4px solid transparent;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .question-card:hover {
      box-shadow: var(--shadow-lg);
    }

    .question-card.unanswered {
      border-left-color: var(--red);
      animation: shake 0.4s ease;
    }

    .question-card.answered {
      border-left-color: var(--green);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-4px); }
      40%, 80% { transform: translateX(4px); }
    }

    .question-card .q-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--navy);
      color: #fff;
      font-size: 0.8rem;
      font-weight: 700;
      margin-right: 0.6rem;
      flex-shrink: 0;
    }

    .question-card .q-title {
      font-weight: 600;
      font-size: 1rem;
      color: var(--text);
      margin-bottom: 0.85rem;
      display: flex;
      align-items: center;
    }

    .question-card .q-title-text {
      flex: 1;
    }

    .question-card .q-subtitle {
      color: var(--text-light);
      font-size: 0.82rem;
      font-weight: 400;
      font-style: italic;
      margin-bottom: 0.6rem;
      padding-left: 2.35rem;
    }

    /* Radio options */
    .options-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .options-grid.two-col {
      grid-template-columns: 1fr 1fr;
    }

    .option-label {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.6rem 0.85rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      font-size: 0.92rem;
      user-select: none;
    }

    .option-label:hover {
      border-color: var(--silver);
      background: #f9fafb;
    }

    .option-label input[type="radio"] {
      appearance: none;
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid var(--silver);
      border-radius: 50%;
      flex-shrink: 0;
      position: relative;
      transition: all 0.15s;
    }

    .option-label input[type="radio"]:checked {
      border-color: var(--green);
      background: var(--green);
    }

    .option-label input[type="radio"]:checked::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #fff;
    }

    .option-label:has(input:checked) {
      border-color: var(--green);
      background: rgba(105, 190, 40, 0.06);
    }

    .option-label.greyed-out {
      opacity: 0.35;
      pointer-events: none;
    }

    .option-text {
      flex: 1;
      font-weight: 500;
    }

    .pos-tag {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-light);
      margin-left: 0.35rem;
    }

    .pts-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      font-size: 0.72rem;
      font-weight: 700;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .pts-badge.low {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .pts-badge.mid {
      background: #fff3e0;
      color: #e65100;
    }

    .pts-badge.high {
      background: #fce4ec;
      color: #c62828;
    }

    /* Submit area */
    .submit-area {
      margin: 2rem 0 3rem;
      text-align: center;
    }

    .error-message {
      background: #fef2f2;
      color: var(--red);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 1rem;
      display: none;
      font-size: 0.95rem;
    }

    .error-message.visible {
      display: block;
    }

    .submit-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: var(--green);
      color: var(--navy);
      border: none;
      padding: 1rem 2.5rem;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 800;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
      box-shadow: 0 4px 14px rgba(105, 190, 40, 0.4);
      width: 100%;
      max-width: 360px;
    }

    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(105, 190, 40, 0.5);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    /* Spinner */
    .spinner {
      display: none;
      width: 22px;
      height: 22px;
      border: 3px solid rgba(0, 34, 68, 0.2);
      border-top-color: var(--navy);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    .spinner.visible {
      display: inline-block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success */
    .success-message {
      text-align: center;
      padding: 2rem 1.5rem;
      display: none;
    }

    .success-message.visible {
      display: block;
    }

    .success-message .success-icon {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: var(--green);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.2rem;
      font-size: 2.2rem;
      animation: popIn 0.4s ease;
    }

    @keyframes popIn {
      0% { transform: scale(0); }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .success-message h2 {
      font-size: 1.4rem;
      color: var(--navy);
      margin-bottom: 0.5rem;
    }

    .success-message p {
      color: var(--text-light);
      margin-bottom: 1.2rem;
    }

    .success-message .leaderboard-link {
      display: inline-block;
      background: var(--navy);
      color: #fff;
      text-decoration: none;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      font-weight: 600;
      transition: opacity 0.2s;
    }

    .success-message .leaderboard-link:hover {
      opacity: 0.9;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-light);
      font-size: 0.8rem;
    }

    /* Party Selector */
    .party-selector {
      text-align: center;
      padding: 2.5rem 1rem;
    }

    .party-selector h2 {
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--navy);
      margin-bottom: 0.3rem;
    }

    .party-selector .party-subtitle {
      color: var(--text-light);
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }

    .party-search {
      width: 100%;
      padding: 0.85rem 1.1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      margin-bottom: 0.75rem;
      background: #fafafa;
    }

    .party-search:focus {
      border-color: var(--green);
      box-shadow: 0 0 0 3px rgba(105, 190, 40, 0.12);
      background: #fff;
    }

    .party-list {
      list-style: none;
      max-height: 260px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .party-list:empty + .party-or-divider {
      display: none;
    }

    .party-list li {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.85rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.15s;
      text-align: left;
      background: #fff;
    }

    .party-list li::before {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--green);
      flex-shrink: 0;
    }

    .party-list li:hover {
      border-color: var(--green);
      background: rgba(105, 190, 40, 0.04);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(105, 190, 40, 0.1);
    }

    .party-or-divider {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0.75rem 0;
      color: var(--text-light);
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .party-or-divider::before,
    .party-or-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #e5e7eb;
    }

    .party-create-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: var(--navy);
      color: #fff;
      border: none;
      padding: 0.85rem 1.8rem;
      border-radius: 50px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0, 34, 68, 0.2);
    }

    .party-create-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0, 34, 68, 0.3);
    }

    .party-create-btn:active {
      transform: translateY(0);
    }

    .party-create-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .party-error {
      color: var(--red);
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 0.75rem;
      display: none;
    }

    .party-error.visible {
      display: block;
    }

    /* Create Party Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-box {
      background: #fff;
      border-radius: 20px;
      padding: 2rem;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      position: relative;
      animation: modalSlideIn 0.25s ease;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: translateY(12px) scale(0.97); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .modal-box h3 {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--navy);
      margin-bottom: 0.4rem;
    }

    .modal-box p {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-bottom: 1.25rem;
    }

    .modal-input {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      margin-bottom: 1rem;
    }

    .modal-input:focus {
      border-color: var(--green);
      box-shadow: 0 0 0 3px rgba(105, 190, 40, 0.12);
    }

    .modal-actions {
      display: flex;
      gap: 0.75rem;
    }

    .modal-actions .btn-cancel {
      flex: 1;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: #fff;
      color: var(--text-light);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
    }

    .modal-actions .btn-cancel:hover {
      border-color: var(--silver);
      color: var(--text);
    }

    .modal-actions .btn-confirm {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 12px;
      background: var(--green);
      color: var(--navy);
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
    }

    .modal-actions .btn-confirm:hover {
      background: #7cd633;
    }

    .modal-actions .btn-confirm:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .modal-error {
      color: var(--red);
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.75rem;
      display: none;
    }

    .modal-error.visible {
      display: block;
    }

    .party-name-display {
      font-weight: 600;
      color: var(--navy);
    }


    /* Responsive tweaks */
    @media (min-width: 480px) {
      .header h1 {
        font-size: 2.6rem;
      }
      .container {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <h1>Super Bowl LX Props &#127944;</h1>
    <p class="subtitle">Seahawks vs Patriots &bull; Feb 8, 2026<span id="header-party-name"></span></p>
    <div class="team-bar">
      <span class="team-badge seahawks">Seahawks</span>
      <span class="vs-text">VS</span>
      <span class="team-badge patriots">Patriots</span>
    </div>
  </div>

  <div class="container">

    <!-- Party Selector (shown when no party chosen) -->
    <div id="party-selector" class="party-selector" style="display:none;">
      <h2>Join a Party</h2>
      <p class="party-subtitle">Search for your party or create a new one</p>
      <input type="text" class="party-search" id="party-search" placeholder="Search parties..." autocomplete="off" />
      <ul class="party-list" id="party-list"></ul>
      <div class="party-or-divider">or</div>
      <button class="party-create-btn" id="party-create-btn">+ Create New Party</button>
      <div class="party-error" id="party-error"></div>
    </div>

    <!-- Create Party Modal -->
    <div class="modal-overlay" id="create-party-modal">
      <div class="modal-box">
        <h3>Create a Party</h3>
        <p>Give your party a name that your guests will recognize.</p>
        <div class="modal-error" id="modal-error"></div>
        <input type="text" class="modal-input" id="modal-party-name" placeholder="e.g. The Johnson's Super Bowl Bash" autocomplete="off" />
        <div class="modal-actions">
          <button class="btn-cancel" id="modal-cancel">Cancel</button>
          <button class="btn-confirm" id="modal-confirm">Create Party</button>
        </div>
      </div>
    </div>

    <!-- Already submitted message (hidden by default) -->
    <div id="already-submitted" class="already-submitted" style="display:none;">
      <div class="check-icon">&#9989;</div>
      <h2>You already submitted!</h2>
      <p>Your picks are locked in as <span id="submitted-name" class="name-highlight"></span> in <span id="submitted-party" class="party-name-display"></span>.</p>
      <a href="leaderboard.html" class="leaderboard-link">View Leaderboard</a>
      <button class="resubmit" id="resubmit-btn">Submit again with a different name</button>
    </div>

    <!-- Form (hidden when already submitted) -->
    <form id="picks-form" autocomplete="off">

      <!-- Name -->
      <div class="name-card">
        <label for="name-input">Your Name</label>
        <input type="text" id="name-input" placeholder="Enter your name..." required />
      </div>

      <!-- PRE-GAME -->
      <div class="section-header"><h2>Pre-Game</h2></div>

      <!-- Q1: Coin Toss -->
      <div class="question-card" data-q="q1">
        <div class="q-title">
          <span class="q-number">1</span>
          <span class="q-title-text">Coin Toss</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q1" value="Heads" />
            <span class="option-text">Heads</span>
            <span class="pts-badge low">1 pt</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q1" value="Tails" />
            <span class="option-text">Tails</span>
            <span class="pts-badge low">1 pt</span>
          </label>
        </div>
      </div>

      <!-- Q2: National Anthem -->
      <div class="question-card" data-q="q2">
        <div class="q-title">
          <span class="q-number">2</span>
          <span class="q-title-text">National Anthem Length (Charlie Puth)</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q2" value="Over 2 min" />
            <span class="option-text">Over 2 min</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q2" value="Under 2 min" />
            <span class="option-text">Under 2 min</span>
            <span class="pts-badge low">2 pts</span>
          </label>
        </div>
      </div>

      <!-- Q3: First Commercial -->
      <div class="question-card" data-q="q3">
        <div class="q-title">
          <span class="q-number">3</span>
          <span class="q-title-text">First Commercial After Kickoff</span>
        </div>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="q3" value="Beer" />
            <span class="option-text">Beer</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="Tech" />
            <span class="option-text">Tech</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="Food" />
            <span class="option-text">Food</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="Movie Trailer" />
            <span class="option-text">Movie Trailer</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q3" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">5 pts</span>
          </label>
        </div>
      </div>

      <!-- FIRST HALF -->
      <div class="section-header"><h2>First Half</h2></div>

      <!-- Q4: First Team to Score -->
      <div class="question-card" data-q="q4">
        <div class="q-title">
          <span class="q-number">4</span>
          <span class="q-title-text">First Team to Score</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q4" value="Seahawks" />
            <span class="option-text">Seahawks</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q4" value="Patriots" />
            <span class="option-text">Patriots</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
        </div>
      </div>

      <!-- Q5: First TD Scorer -->
      <div class="question-card" data-q="q5">
        <div class="q-title">
          <span class="q-number">5</span>
          <span class="q-title-text">First Touchdown Scorer</span>
        </div>
        <div class="q-subtitle">QBs must rush or receive the touchdown to count</div>
        <div class="options-grid">
          <label class="option-label" data-team="Seahawks">
            <input type="radio" name="q5" value="Kenneth Walker III" />
            <span class="option-text">Kenneth Walker III <span class="pos-tag">RB, SEA</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label" data-team="Seahawks">
            <input type="radio" name="q5" value="Jaxon Smith-Njigba" />
            <span class="option-text">Jaxon Smith-Njigba <span class="pos-tag">WR, SEA</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label" data-team="Patriots">
            <input type="radio" name="q5" value="Rhamondre Stevenson" />
            <span class="option-text">Rhamondre Stevenson <span class="pos-tag">RB, NE</span></span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label" data-team="Patriots">
            <input type="radio" name="q5" value="Hunter Henry" />
            <span class="option-text">Hunter Henry <span class="pos-tag">TE, NE</span></span>
            <span class="pts-badge high">7 pts</span>
          </label>
          <label class="option-label" data-team="Patriots">
            <input type="radio" name="q5" value="Stefon Diggs" />
            <span class="option-text">Stefon Diggs <span class="pos-tag">WR, NE</span></span>
            <span class="pts-badge high">7 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q5" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">10 pts</span>
          </label>
        </div>
      </div>

      <!-- Q6: First Half Total Points -->
      <div class="question-card" data-q="q6">
        <div class="q-title">
          <span class="q-number">6</span>
          <span class="q-title-text">First Half Total Points</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q6" value="Over 22.5" />
            <span class="option-text">Over 22.5</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q6" value="Under 22.5" />
            <span class="option-text">Under 22.5</span>
            <span class="pts-badge low">2 pts</span>
          </label>
        </div>
      </div>

      <!-- HALFTIME -->
      <div class="section-header"><h2>Halftime</h2></div>

      <!-- Q7: Bad Bunny's First Song -->
      <div class="question-card" data-q="q7">
        <div class="q-title">
          <span class="q-number">7</span>
          <span class="q-title-text">Bad Bunny's First Song</span>
        </div>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="q7" value="Titi Me Pregunto" />
            <span class="option-text">Titi Me Pregunt&oacute;</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="DtMF" />
            <span class="option-text">DtMF</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="Baile Inolvidable" />
            <span class="option-text">Baile Inolvidable</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="Monaco" />
            <span class="option-text">Monaco</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q7" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">7 pts</span>
          </label>
        </div>
      </div>

      <!-- Q8: Halftime Guest -->
      <div class="question-card" data-q="q8">
        <div class="q-title">
          <span class="q-number">8</span>
          <span class="q-title-text">Halftime Guest Performer</span>
        </div>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="q8" value="Cardi B" />
            <span class="option-text">Cardi B</span>
            <span class="pts-badge low">1 pt</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="Rosalia" />
            <span class="option-text">Rosal&iacute;a</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="Karol G" />
            <span class="option-text">Karol G</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="No Guest" />
            <span class="option-text">No Guest</span>
            <span class="pts-badge high">7 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q8" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">10 pts</span>
          </label>
        </div>
      </div>

      <!-- FULL GAME -->
      <div class="section-header"><h2>Full Game</h2></div>

      <!-- Q9: QB Yards -->
      <div class="question-card" data-q="q9">
        <div class="q-title">
          <span class="q-number">9</span>
          <span class="q-title-text">Which QB Throws For More Yards?</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q9" value="Sam Darnold" />
            <span class="option-text">Sam Darnold <span class="pos-tag">QB, SEA</span></span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q9" value="Drake Maye" />
            <span class="option-text">Drake Maye <span class="pos-tag">QB, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
        </div>
      </div>

      <!-- Q10: Defensive/ST TD -->
      <div class="question-card" data-q="q10">
        <div class="q-title">
          <span class="q-number">10</span>
          <span class="q-title-text">Defensive or Special Teams TD?</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q10" value="Yes" />
            <span class="option-text">Yes</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q10" value="No" />
            <span class="option-text">No</span>
            <span class="pts-badge low">1 pt</span>
          </label>
        </div>
      </div>

      <!-- Q11: Total Game Points -->
      <div class="question-card" data-q="q11">
        <div class="q-title">
          <span class="q-number">11</span>
          <span class="q-title-text">Total Game Points</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q11" value="Over 45.5" />
            <span class="option-text">Over 45.5</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q11" value="Under 45.5" />
            <span class="option-text">Under 45.5</span>
            <span class="pts-badge low">2 pts</span>
          </label>
        </div>
      </div>

      <!-- Q12: Longest FG -->
      <div class="question-card" data-q="q12">
        <div class="q-title">
          <span class="q-number">12</span>
          <span class="q-title-text">Longest Field Goal</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q12" value="Under 49.5 yds" />
            <span class="option-text">Under 49.5 yds</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q12" value="Over 49.5 yds" />
            <span class="option-text">Over 49.5 yds</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
        </div>
      </div>

      <!-- OUTCOME -->
      <div class="section-header"><h2>Outcome</h2></div>

      <!-- Q13: Winner -->
      <div class="question-card" data-q="q13">
        <div class="q-title">
          <span class="q-number">13</span>
          <span class="q-title-text">Super Bowl Winner</span>
        </div>
        <div class="options-grid two-col">
          <label class="option-label">
            <input type="radio" name="q13" value="Seahawks" />
            <span class="option-text">Seahawks</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q13" value="Patriots" />
            <span class="option-text">Patriots</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
        </div>
      </div>

      <!-- Q14: MVP -->
      <div class="question-card" data-q="q14">
        <div class="q-title">
          <span class="q-number">14</span>
          <span class="q-title-text">Super Bowl MVP</span>
        </div>
        <div class="options-grid">
          <label class="option-label" data-team="Seahawks">
            <input type="radio" name="q14" value="Sam Darnold" />
            <span class="option-text">Sam Darnold <span class="pos-tag">QB, SEA</span></span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label" data-team="Patriots">
            <input type="radio" name="q14" value="Drake Maye" />
            <span class="option-text">Drake Maye <span class="pos-tag">QB, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label" data-team="Seahawks">
            <input type="radio" name="q14" value="Kenneth Walker III" />
            <span class="option-text">Kenneth Walker III <span class="pos-tag">RB, SEA</span></span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label" data-team="Seahawks">
            <input type="radio" name="q14" value="Jaxon Smith-Njigba" />
            <span class="option-text">Jaxon Smith-Njigba <span class="pos-tag">WR, SEA</span></span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q14" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">7 pts</span>
          </label>
        </div>
      </div>

      <!-- Q15: Gatorade Bath -->
      <div class="question-card" data-q="q15">
        <div class="q-title">
          <span class="q-number">15</span>
          <span class="q-title-text">Gatorade Bath Color</span>
        </div>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="q15" value="Orange" />
            <span class="option-text">Orange</span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q15" value="Yellow/Green" />
            <span class="option-text">Yellow/Green</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q15" value="Blue" />
            <span class="option-text">Blue</span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q15" value="Purple" />
            <span class="option-text">Purple</span>
            <span class="pts-badge high">5 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q15" value="Red/Pink" />
            <span class="option-text">Red/Pink</span>
            <span class="pts-badge high">7 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q15" value="None/Clear" />
            <span class="option-text">None/Clear</span>
            <span class="pts-badge high">7 pts</span>
          </label>
        </div>
      </div>

      <!-- BONUS -->
      <div class="section-header"><h2>Bonus: Anytime TD Scorer</h2></div>

      <!-- Q16: Anytime TD -->
      <div class="question-card" data-q="q16">
        <div class="q-title">
          <span class="q-number">16</span>
          <span class="q-title-text">Pick ONE Anytime TD Scorer</span>
        </div>
        <div class="q-subtitle">QBs must rush or receive the touchdown to count</div>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="q16" value="Kenneth Walker III" />
            <span class="option-text">Kenneth Walker III <span class="pos-tag">RB, SEA</span></span>
            <span class="pts-badge low">1 pt</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Jaxon Smith-Njigba" />
            <span class="option-text">Jaxon Smith-Njigba <span class="pos-tag">WR, SEA</span></span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Rhamondre Stevenson" />
            <span class="option-text">Rhamondre Stevenson <span class="pos-tag">RB, NE</span></span>
            <span class="pts-badge low">2 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Hunter Henry" />
            <span class="option-text">Hunter Henry <span class="pos-tag">TE, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="AJ Barner" />
            <span class="option-text">AJ Barner <span class="pos-tag">TE, SEA</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Stefon Diggs" />
            <span class="option-text">Stefon Diggs <span class="pos-tag">WR, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Cooper Kupp" />
            <span class="option-text">Cooper Kupp <span class="pos-tag">WR, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Drake Maye" />
            <span class="option-text">Drake Maye <span class="pos-tag">QB, NE</span></span>
            <span class="pts-badge mid">3 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Kayshon Boutte" />
            <span class="option-text">Kayshon Boutte <span class="pos-tag">WR, NE</span></span>
            <span class="pts-badge mid">4 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Rashid Shaheed" />
            <span class="option-text">Rashid Shaheed <span class="pos-tag">WR, NE</span></span>
            <span class="pts-badge mid">4 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Sam Darnold" />
            <span class="option-text">Sam Darnold <span class="pos-tag">QB, SEA</span></span>
            <span class="pts-badge high">7 pts</span>
          </label>
          <label class="option-label">
            <input type="radio" name="q16" value="Other" />
            <span class="option-text">Other</span>
            <span class="pts-badge high">10 pts</span>
          </label>
        </div>
      </div>

      <!-- Submit -->
      <div class="submit-area">
        <div class="error-message" id="error-msg"></div>
        <button type="submit" class="submit-btn" id="submit-btn">
          <span id="btn-text">Lock In My Picks! &#127944;</span>
          <span class="spinner" id="spinner"></span>
        </button>
      </div>

    </form>

    <!-- Success message (hidden) -->
    <div class="success-message" id="success-msg">
      <div class="success-icon">&#127942;</div>
      <h2>Picks Locked In!</h2>
      <p>Good luck! May the best prop bettor win.</p>
      <a href="leaderboard.html" class="leaderboard-link">View Leaderboard</a>
    </div>

    <div class="footer">
      Super Bowl LX Props &mdash; For fun, not real betting.
    </div>

  </div>

  <script>
    const SUPABASE_URL = 'https://qwyphndhccvisrhkufvz.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_247YYeO-v6NH4_8B8WC8bA_0hfFrr9O';

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('picks-form');
    const nameInput = document.getElementById('name-input');
    const errorMsg = document.getElementById('error-msg');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const spinner = document.getElementById('spinner');
    const successMsg = document.getElementById('success-msg');
    const alreadySubmitted = document.getElementById('already-submitted');
    const submittedNameEl = document.getElementById('submitted-name');
    const submittedPartyEl = document.getElementById('submitted-party');
    const resubmitBtn = document.getElementById('resubmit-btn');
    const partySelector = document.getElementById('party-selector');
    const partySearchInput = document.getElementById('party-search');
    const partyList = document.getElementById('party-list');
    const partyCreateBtn = document.getElementById('party-create-btn');
    const partyErrorEl = document.getElementById('party-error');
    const headerPartyName = document.getElementById('header-party-name');

    const TOTAL_QUESTIONS = 16;

    // ============================
    // PAGE LOAD FLOW
    // ============================
    (async function init() {
      // Clear old integer-format party IDs (pre-UUID migration)
      const storedId = localStorage.getItem('sbPartyId');
      if (storedId && /^\d+$/.test(storedId)) {
        localStorage.removeItem('sbPartyId');
        localStorage.removeItem('sbPartyDisplayName');
        localStorage.removeItem('sbPartyName');
        location.reload();
        return;
      }

      // Handle ?party=UUID deep link
      const urlParams = new URLSearchParams(window.location.search);
      const partyParam = urlParams.get('party');
      if (partyParam && partyParam !== storedId) {
        const { data } = await supabaseClient
          .from('parties')
          .select('id, name')
          .eq('id', partyParam)
          .single();
        if (data) {
          localStorage.setItem('sbPartyId', data.id);
          localStorage.setItem('sbPartyDisplayName', data.name);
          window.history.replaceState({}, '', window.location.pathname);
          location.reload();
          return;
        }
      }
      if (partyParam) {
        window.history.replaceState({}, '', window.location.pathname);
      }

      const partyId = localStorage.getItem('sbPartyId');
      const partyDisplayName = localStorage.getItem('sbPartyDisplayName');
      const savedName = localStorage.getItem('sbPartyName');

      if (!partyId) {
        // No party selected â€” show party selector
        partySelector.style.display = 'block';
        form.style.display = 'none';
        loadParties();
        return;
      }

      // Show party name in header
      headerPartyName.textContent = ' \u2022 ' + partyDisplayName;

      if (savedName) {
        // Already submitted
        form.style.display = 'none';
        alreadySubmitted.style.display = 'block';
        submittedNameEl.textContent = savedName;
        submittedPartyEl.textContent = partyDisplayName;
      }
      // Otherwise: show form (default)
    })();

    // ============================
    // PARTY SELECTOR
    // ============================
    let allParties = [];

    async function loadParties() {
      const { data, error } = await supabaseClient
        .from('parties')
        .select('id, name, created_at')
        .order('name');

      if (error) {
        console.error('Error loading parties:', error);
        return;
      }
      allParties = data || [];
      renderPartyList();
    }

    function renderPartyList() {
      const search = partySearchInput.value.trim().toLowerCase();
      const filtered = search
        ? allParties.filter(p => p.name.toLowerCase().includes(search))
        : allParties;

      partyList.innerHTML = '';
      filtered.forEach(function (party) {
        const li = document.createElement('li');
        li.textContent = party.name;
        li.addEventListener('click', function () {
          selectParty(party.id, party.name);
        });
        partyList.appendChild(li);
      });
    }

    partySearchInput.addEventListener('input', renderPartyList);

    function selectParty(id, name) {
      localStorage.setItem('sbPartyId', id);
      localStorage.setItem('sbPartyDisplayName', name);
      location.reload();
    }

    // ============================
    // CREATE PARTY MODAL
    // ============================
    const createModal = document.getElementById('create-party-modal');
    const modalNameInput = document.getElementById('modal-party-name');
    const modalConfirmBtn = document.getElementById('modal-confirm');
    const modalCancelBtn = document.getElementById('modal-cancel');
    const modalErrorEl = document.getElementById('modal-error');

    partyCreateBtn.addEventListener('click', function () {
      modalNameInput.value = partySearchInput.value.trim();
      modalErrorEl.classList.remove('visible');
      createModal.classList.add('show');
      setTimeout(() => modalNameInput.focus(), 100);
    });

    modalCancelBtn.addEventListener('click', function () {
      createModal.classList.remove('show');
    });

    createModal.addEventListener('click', function (e) {
      if (e.target === createModal) createModal.classList.remove('show');
    });

    modalNameInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') doCreateParty();
    });

    modalConfirmBtn.addEventListener('click', doCreateParty);

    async function doCreateParty() {
      const name = modalNameInput.value.trim();
      if (!name) {
        showModalError('Please enter a party name');
        modalNameInput.focus();
        return;
      }

      hideModalError();
      modalConfirmBtn.disabled = true;
      modalConfirmBtn.textContent = 'Creating...';

      try {
        const { data: partyRows, error: partyError } = await supabaseClient
          .rpc('create_party', { p_name: name });

        if (partyError) {
          if (partyError.code === '23505') {
            showModalError('A party with that name already exists!');
            return;
          }
          throw partyError;
        }

        const partyData = partyRows[0];

        // Save creator token for admin access
        const tokens = JSON.parse(localStorage.getItem('sbCreatorTokens') || '{}');
        tokens[partyData.id] = partyData.creator_token;
        localStorage.setItem('sbCreatorTokens', JSON.stringify(tokens));

        selectParty(partyData.id, partyData.name);
      } catch (err) {
        console.error('Error creating party:', err);
        showModalError('Error: ' + (err.message || 'Unknown error'));
      } finally {
        modalConfirmBtn.disabled = false;
        modalConfirmBtn.textContent = 'Create Party';
      }
    }

    function showModalError(msg) {
      modalErrorEl.textContent = msg;
      modalErrorEl.classList.add('visible');
    }

    function hideModalError() {
      modalErrorEl.textContent = '';
      modalErrorEl.classList.remove('visible');
    }

    // ============================
    // CHANGE PARTY / RESUBMIT
    // ============================
    resubmitBtn.addEventListener('click', function () {
      localStorage.removeItem('sbPartyName');
      location.reload();
    });

    // ============================
    // TEAM FILTER (greying out)
    // ============================
    function applyTeamFilter(triggerName, targetQ, targetName) {
      document.querySelectorAll('input[name="' + triggerName + '"]').forEach(function (radio) {
        radio.addEventListener('change', function () {
          var selectedTeam = this.value;
          var labels = document.querySelectorAll('[data-q="' + targetQ + '"] .option-label[data-team]');
          var selected = form.querySelector('input[name="' + targetName + '"]:checked');
          if (selected) {
            var parentLabel = selected.closest('.option-label');
            if (parentLabel.dataset.team && parentLabel.dataset.team !== selectedTeam) {
              selected.checked = false;
              var card = parentLabel.closest('.question-card');
              card.classList.remove('answered');
            }
          }
          labels.forEach(function (label) {
            if (label.dataset.team !== selectedTeam) {
              label.classList.add('greyed-out');
            } else {
              label.classList.remove('greyed-out');
            }
          });
        });
      });
    }

    applyTeamFilter('q4', 'q5', 'q5');
    applyTeamFilter('q13', 'q14', 'q14');

    // Mark cards as answered
    document.querySelectorAll('input[type="radio"]').forEach(function (radio) {
      radio.addEventListener('change', function () {
        const card = this.closest('.question-card');
        card.classList.remove('unanswered');
        card.classList.add('answered');
      });
    });

    // ============================
    // ERROR / LOADING HELPERS
    // ============================
    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.classList.add('visible');
      errorMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function hideError() {
      errorMsg.textContent = '';
      errorMsg.classList.remove('visible');
    }

    function setLoading(loading) {
      submitBtn.disabled = loading;
      if (loading) {
        btnText.style.display = 'none';
        spinner.classList.add('visible');
      } else {
        btnText.style.display = 'inline';
        spinner.classList.remove('visible');
      }
    }

    // ============================
    // FORM SUBMIT
    // ============================
    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      hideError();

      const partyId = localStorage.getItem('sbPartyId');
      if (!partyId) {
        showError('No party selected. Please reload and select a party.');
        return;
      }

      const name = nameInput.value.trim();
      if (!name) {
        nameInput.classList.add('error');
        nameInput.focus();
        showError('Please enter your name!');
        return;
      }
      nameInput.classList.remove('error');

      let allAnswered = true;
      const answers = {};

      for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
        const qName = 'q' + i;
        const selected = form.querySelector('input[name="' + qName + '"]:checked');
        const card = document.querySelector('[data-q="' + qName + '"]');

        if (!selected) {
          allAnswered = false;
          card.classList.add('unanswered');
          card.classList.remove('answered');
        } else {
          answers[qName] = selected.value;
          card.classList.remove('unanswered');
        }
      }

      if (!allAnswered) {
        showError('Please answer all questions before submitting!');
        const firstUnanswered = document.querySelector('.question-card.unanswered');
        if (firstUnanswered) {
          firstUnanswered.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }

      setLoading(true);

      try {
        // Check if name already exists in this party
        const { data: existing, error: checkError } = await supabaseClient
          .from('party_picks')
          .select('name')
          .eq('party_id', partyId)
          .eq('name', name)
          .limit(1);

        if (checkError) throw checkError;

        if (existing && existing.length > 0) {
          setLoading(false);
          nameInput.classList.add('error');
          showError('Someone with that name already submitted picks at your party! Try adding a last initial (e.g. "Mike B.")');
          return;
        }

        // Insert the picks with party_id
        const row = { party_id: partyId, name: name, ...answers };
        const { error: insertError } = await supabaseClient
          .from('party_picks')
          .insert(row);

        if (insertError) throw insertError;

        // Success
        localStorage.setItem('sbPartyName', name);
        form.style.display = 'none';
        successMsg.classList.add('visible');
        window.scrollTo({ top: 0, behavior: 'smooth' });

      } catch (err) {
        console.error('Submission error:', err);
        showError('Something went wrong. Please try again! (' + (err.message || 'Unknown error') + ')');
      } finally {
        setLoading(false);
      }
    });
  </script>

</body>
</html>
